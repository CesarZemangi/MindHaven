@model Mindhaven.ViewModel.MindHavenDashboardViewModel

@{
    ViewBag.Title = "Home Page";
}




<link href="~/Template/css/plugins/datatables/datatables.min.css" rel="stylesheet">


@if (Session["Role"] == null)
{
    Response.Redirect("~/Login/Login");
}
<a href="/Support/HelpNow" class="btn btn-danger btn-sm float-right">
    🆘 Need Help? Talk to Someone Now
</a>


<div class="row">
    @* Total Mood Logs (Yearly) *@
    <div class="col-lg-3">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-success pull-right">Yearly</span>
                <h5>Total Mood Entries</h5>
            </div>
            <div class="ibox-content">
                @{
                    var yearlyMoodLogs = Model.MoodLogs
.Where(m => m.LoggedAt.HasValue && m.LoggedAt.Value.Year == DateTime.Today.Year)
.Count();

                }
                <h1 class="no-margins">@yearlyMoodLogs</h1>
                <div class="stat-percent font-bold text-success">+18% <i class="fa fa-smile-o"></i></div>
                <small>Logged this year</small>
            </div>
        </div>
    </div>

    @* Today's Mood Entries *@
    <div class="col-lg-3">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-info pull-right">Daily</span>
                <h5>Today's Mood Logs</h5>
            </div>
            <div class="ibox-content">
                @{
                    var todayMoodLogs = Model.MoodLogs
.Where(m => m.LoggedAt.HasValue && m.LoggedAt.Value.Date == DateTime.Today)
.Count();

                }
                <h1 class="no-margins">@todayMoodLogs</h1>
                <div class="stat-percent font-bold text-info">+5% <i class="fa fa-calendar-check-o"></i></div>
                <small>Logged today</small>
            </div>
        </div>
    </div>

    @* Completed Assessments *@
    <div class="col-lg-3">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-primary pull-right">All Time</span>
                <h5>Self-Assessments Taken</h5>
            </div>
            <div class="ibox-content">
                <h1 class="no-margins">@Model.AssessmentResults.Count()</h1>
                <div class="stat-percent font-bold text-primary">+12% <i class="fa fa-bar-chart"></i></div>
                <small>Assessment history</small>
            </div>
        </div>
    </div>

    @* Upcoming Appointments *@
    <div class="col-lg-3">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-warning pull-right">This Week</span>
                <h5>Upcoming Sessions</h5>
            </div>
            <div class="ibox-content">
                @{
                    var weekStart = DateTime.Today;
                    var weekEnd = weekStart.AddDays(7);
                    var upcoming = Model.Appointments
                        .Where(a => a.AppointmentDate >= weekStart && a.AppointmentDate <= weekEnd)
                        .Count();
                }
                <h1 class="no-margins">@upcoming</h1>
                <div class="stat-percent font-bold text-warning">+10% <i class="fa fa-handshake-o"></i></div>
                <small>Within 7 days</small>
            </div>
        </div>
    </div>
</div>


<div class="row">
    <!-- Mood Logs Overview -->
    <div class="col-lg-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-primary pull-right">Today</span>
                <h5>Mood Logs</h5>
            </div>
            <div class="ibox-content">
                <div class="row">
                    <div class="col-md-6">
                        <h1 class="no-margins">
                            @Model.MoodLogs.Count(m => m.LoggedAt.HasValue && m.LoggedAt.Value.Date == DateTime.Today)
                            )
                        </h1>
                        <div class="font-bold text-navy">+44% <i class="fa fa-smile-o"></i> <small>Daily insight</small></div>
                    </div>
                    <div class="col-md-6">
                        <h1 class="no-margins">@Model.MoodLogs.Count()</h1>
                        <div class="font-bold text-navy">+22% <i class="fa fa-line-chart"></i> <small>All-time entries</small></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Placeholder -->
    <div class="col-lg-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>Wellness Calendar</h5>
                <div class="ibox-tools">
                    <span class="label label-primary">Updated @DateTime.Now.ToShortTimeString()</span>
                </div>
            </div>
            <div class="ibox-content no-padding">
                <div class="flot-chart m-t-lg" style="height: 55px;">
                    <div class="flot-chart-content" id="wellness-calendar-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Meditation Stats -->
    <div class="col-lg-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-info pull-right">Weekly</span>
                <h5>Meditation Sessions</h5>
            </div>
            <div class="ibox-content">
                <h1 class="no-margins">
                    @Model.RecommendedMeditations.Count(m => m.DateCreated >= DateTime.Today.AddDays(-7))
                    )
                    )
                </h1>
                <div class="font-bold text-info">+10% <i class="fa fa-magic"></i> <small>This week</small></div>
            </div>
        </div>
    </div>
</div>

<!-- Progress & Activity Section -->
<div class="row">
    <!-- Assessments & Mood Trends -->
    <div class="col-lg-8">
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div>
                    <span class="pull-right text-right">
                        <small>Overview of self-assessments taken in <strong>@DateTime.Today.ToString("MMMM yyyy")</strong></small><br />
                        Total assessments: @Model.AssessmentResults.Count()
                    </span>
                    <h3 class="font-bold no-margins">Wellness Progress Trend</h3>
                    <small>Emotional wellbeing tracking</small>
                </div>

                <div class="m-t-sm">
                    <div class="row">
                        <div class="col-md-8">
                            <div>
                                <canvas id="assessmentLineChart" height="114"></canvas>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <ul class="stat-list m-t-lg">
                                <li>
                                    <h2 class="no-margins">@Model.AssessmentResults.Count((m => m.TakenAt >= DateTime.Today.AddDays(-30)))</h2>
                                    <small>Assessments this month</small>
                                    <div class="progress progress-mini">
                                        <div class="progress-bar" style="width: 70%;"></div>
                                    </div>
                                </li>
                                <li>
                                    <h2 class="no-margins">@Model.MoodLogs.Count(m => m.LoggedAt >= DateTime.Today.AddDays(-30))</h2>
                                    <small>Mood entries this month</small>
                                    <div class="progress progress-mini">
                                        <div class="progress-bar" style="width: 55%;"></div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="m-t-md">
                    <small class="pull-right"><i class="fa fa-clock-o"></i> Updated @DateTime.Now.ToShortDateString()</small>
                    <small><strong>Note:</strong> Regular mood tracking helps identify emotional patterns and triggers.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- User Activity Summary -->
    <div class="col-lg-4">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <span class="label label-warning pull-right">Engagement</span>
                <h5>User Activity Overview</h5>
            </div>
            <div class="ibox-content">
                <div class="row">
                    <div class="col-xs-4">
                        <small class="stats-label">Active Users Today</small>
                        <h4>
                            @Model.Users.Count(u => u.CreatedAt.Value.Year == DateTime.Today.Year)
                            )
                        </h4>
                    </div>
                    <div class="col-xs-4">
                        <small class="stats-label">New Signups</small>
                        <h4>@Model.Users.Count(u => u.CreatedAt.Value.Date == DateTime.Today)</h4>
                    </div>
                    <div class="col-xs-4">
                        <small class="stats-label">Support Messages</small>
                        <h4>@Model.SupportMessages.Count(m => m.CreatedAt.Value.Date == DateTime.Today)</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<div class="ibox float-e-margins">
    <div class="ibox-title">
        <h5>List of Guided Meditations</h5>
        <div class="ibox-tools">
            <a class="collapse-link">
                <i class="fa fa-chevron-up"></i>
            </a>
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="fa fa-wrench"></i>
            </a>
            <a class="close-link">
                <i class="fa fa-times"></i>
            </a>
        </div>
    </div>

    <div class="ibox-content">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover dataTables-example">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Media Link</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var meditation in Model.MeditationList)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => meditation.Title)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => meditation.Category)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => meditation.Description)
                            </td>
                            <td>
                                <a href="@meditation.MediaURL" target="_blank">Play</a>
                            </td>
                            <td>
                            <td>
                                @if (Session["Role"] != null && Session["Role"].ToString() == "Admin")
                                {
                                    @Html.ActionLink("Edit", "Edit", new { id = meditation.MeditationID })
                                }
                            </td>


                            <td>
                            @Html.ActionLink("Details", "Details", new { id = meditation.MeditationID }) |

                            @if (Session["Role"] !=null && Session["Role"].ToString() == "Admin")
                            {
                                @Html.ActionLink("Edit", "Edit", new { id = meditation.MeditationID })
                            }

                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Media Link</th>
                        <th>Action</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>



<script src="~/Template/js/jquery-3.1.1.min.js"></script>

<script>
    $(document).ready(function () {
        $('.dataTables-example').DataTable({
            pageLength: 25,
            responsive: true,
            dom: '<"html5buttons"B>lTfgitp',
            buttons: [
                { extend: 'copy' },
                { extend: 'csv' },
                { extend: 'excel', title: 'excel' },
                { extend: 'pdf', title: 'pdf' },

                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                            .addClass('compact')
                            .css('font-size', 'inherit');
                    }
                }
            ]

        });

    });

</script>















