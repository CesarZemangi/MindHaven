
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - MindHaven Support System </title>





    <link href="~/Template/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/Template/font-awesome/css/font-awesome.css" rel="stylesheet">



    <!--morris-->
    <link href="~/Template/css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">

    <link href="~/Template/css/animate.css" rel="stylesheet">
    <link href="~/Template/css/style.css" rel="stylesheet">

    @*<link href="~/Template/css/plugins/datatables/datatables.min.css" rel="stylesheet">*@
   

</head>
<body>
    @if (Session["UserID"] != null)
    {
        <p style="color:green">Logged in as: @Session["UserID"]</p>
    }
    else
    {
        <p style="color:red">Session is NULL (User not recognized)</p>
    }



    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                        <span>
                            <img alt="image" class="img-circle" src="~/Template/img/admin1.jpg" width="60">
                        </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear">
                                @if (Session["Name"] != null && Session["Role"] != null)
                                {
                                    <span class="clear">
                                        <span class="block m-t-xs">
                                            <strong class="font-bold">@Session["Name"]</strong>
                                        </span>
                                        <span class="text-muted text-xs block">@Session["Role"] <b class="caret"></b></span>
                                    </span>
                                }
                                else
                                {
                                    <span class="clear">
                                        <span class="block m-t-xs">
                                            <strong class="font-bold">Guest</strong>
                                        </span>
                                        <span class="text-muted text-xs block">Not Logged In</span>
                                    </span>
                                }

                            </span>
                        </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">

                            <li class="divider"></li>
                            <li><a href="~/Login/Logout">Logout</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li class="active">
                    <a href="~/Home/Index"><i class="fa fa-th-large"></i> <span class="nav-label">Dashboards</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-user"></i> <span class="nav-label">My Account</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="~/User/Edit/@Session["UserID"]">Edit Profile</a></li>
                        <li><a href="~/Users/ChangePassword/@Session["UserID"]">Change Password</a></li>
                    </ul>
                </li>

                @if (Session["Role"] != null && Session["Role"].ToString() == "Admin")
                {
                    <li>
                        <a href="users.html"><i class="fa fa-user"></i> <span class="nav-label">Users</span></a>
                        <ul class="nav nav-second-level">
                            <li><a href="~/Users/Create">Add New User</a></li>
                            <li><a href="~/Users/Index">Manage Users & Roles</a></li>
                            <li><a href="~/UserActivities/Index">User Activity Log</a></li>
                        </ul>
                    </li>
                }

                <li>
                    <a href="#"><i class="fa fa-calendar-check"></i> <span class="nav-label">Therapy</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="~/Appointments/Create">Book Appointment</a></li>
                        <li><a href="~/Appointments/Index">My Appointments</a></li>
                        <li><a href="~/Therapists/Index">Therapist Directory</a></li>
                    </ul>
                </li>

                <li>
                    <a href="#"><i class="fa fa-smile"></i> <span class="nav-label">Mood & Self-Care</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">


                        <li><a href="~/MoodLogs/Create">Log Mood</a></li>
                        <li><a href="~/MoodLogs/Index">Mood History</a></li>
                        <li><a href="~/Meditations/Index">Meditations</a></li>
                        <li><a href="~/Resources/Index">Resources</a></li>
                        <li>@Html.ActionLink("Help Now", "HelpNow", "Support")</li>
                        <li>@Html.ActionLink("My Journal", "MyJournal", "JournalEntry")</li>
                        <li>@Html.ActionLink("Mood Dashboard", "Dashboard", "MoodLogs")</li>
                        <li>@Html.ActionLink("Achievements", "Dashboard", "UserAchievements")</li>


                    </ul>
                </li>

                <li>
                    <a href="#"><i class="fa fa-clipboard-list"></i> <span class="nav-label">Assessments</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="~/Assessments/Index">Available Assessments</a></li>
                        <li><a href="~/AssessmentResults/Index">My Results</a></li>
                        @if (Session["Role"] != null && Session["Role"].ToString() == "Admin")
                        {
                            <li><a href="~/Assessments/Create">Add Assessment</a></li>
                            <li><a href="~/AssessmentQuestions/Index">Manage Questions</a></li>
                        }

                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-users"></i> <span class="nav-label">Support Groups</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="~/SupportGroups/Index">Browse Groups</a></li>
                        <li><a href="~/GroupPosts/Index">Group Posts</a></li>
                        @if (Session["Role"] != null && Session["Role"].ToString() == "Admin")
                        {
                            <li><a href="~/SupportGroups/Create">Create Group</a></li>
                        }
                    </ul>
                </li>

                @if (Session["Role"] != null && (Session["Role"].ToString() == "Admin" || Session["Role"].ToString() == "Therapist"))
                {
                    <li>
                        <a href="#"><i class="fa fa-tools"></i> <span class="nav-label">Admin Panel</span> <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            @if (Session["Role"].ToString() == "Admin")
                            {
                                <li><a href="~/Users/Index">Manage Users</a></li>
                            }
                            <li><a href="~/Therapists/Create">Add Therapist</a></li>
                            <li><a href="~/Meditations/Create">Add Meditation</a></li>
                            <li><a href="~/Resources/Create">Add Resource</a></li>
                            <li><a href="~/MeditationDeleteRequests/Index">Review Delete Requests</a></li> <!-- ✅ Add this -->
                            <li><a href="~/DeleteRequests/Index">Review Delete Requests</a></li>
                            <li>@Html.ActionLink("Emergency Contacts", "Index", "EmergencyContacts")</li>

                        </ul>
                    </li>
                }
                <li>
                    <a href="#"><i class="fa fa-newspaper-o"></i> <span class="nav-label">Landing Page</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="~/Home/Landing">View Landing Page</a></li>
                    </ul>
                </li>
                <li>
                    @if (Session["UserId"] != null && ViewBag.HasPendingReminder == true)
                    {
                        <div class="alert alert-info text-center">
                            How are you feeling today? <a href="/MoodLogs/Create">Log your mood</a>
                        </div>
                    }
                </li>

                <li>@Html.ActionLink("Therapeutic Homework", "HomeworkDashboard", "Home")</li>


                <li>
                    <a href="~/Account/Logout"><i class="fa fa-sign-out-alt"></i> <span class="nav-label">Logout</span></a>
                </li>

            </ul>

        </div>
    </nav>

    <div class="modal fade" id="panicModal" tabindex="-1" role="dialog" aria-labelledby="panicModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content text-center p-4">
                <h4 id="panicModalLabel">Take a Deep Breath</h4>
                <div class="my-3">
                    <div id="breathingCircle" style="width: 100px; height: 100px; margin: auto; border-radius: 50%; background-color: lightblue; animation: breathe 8s ease-in-out infinite;"></div>
                    <p class="mt-3">Inhale... Exhale...</p>
                </div>

                <!-- Optional calming audio -->
                <audio id="calmAudio" loop>
                    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5e3b63b7e0.mp3?filename=meditation-110397.mp3" type="audio/mp3">
                </audio>


                <a href="@Url.Action("HelpNow", "Home")" class="btn btn-primary">Help Now</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                @section Scripts {
                    <script>
        document.getElementById("panicButton").addEventListener("click", function () {
            window.location.href = "@Url.Action("HelpNow", "Home")";
        });
                    </script>
                }
            </div>
        </div>
    </div>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                    <form role="search" class="navbar-form-custom" action="search_results.html">
                        <div class="form-group">
                            <input type="text" placeholder="Search for something..." class="form-control" name="top-search" id="top-search">
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Welcome to Mindhaven .</span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-envelope"></i>  <span class="label label-warning">16</span>
                        </a>

                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                        </a>

                    </li>


                    <li>
                        <a href="~/Login/Logout">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                    <li>
                        <a class="right-sidebar-toggle">
                            <i class="fa fa-tasks"></i>
                        </a>
                    </li>
                </ul>

            </nav>
        </div>



        @RenderBody()


        <footer class="text-center mt-5">
            <p>If you are in crisis, <a href="/Support/HelpNow" class="text-danger font-weight-bold">click here to get immediate help</a>.</p>
        </footer>

        <div class="footer">
            <div class="pull-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <button id="panicButton" class="btn btn-danger" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
                    🚨 Panic
                </button>
            </div>
            <div>
                <p>&copy; @DateTime.Now.Year - Mindhaven</p>
            </div>

        </div>

    </div>


    <div id="right-sidebar">
        <div class="sidebar-container">

            <ul class="nav nav-tabs navs-2">
                <li class="active">
                    <a data-toggle="tab" href="#tab-notes">Notes</a>
                </li>
                <li>
                    <a data-toggle="tab" href="#tab-settings"><i class="fa fa-gear"></i></a>
                </li>
            </ul>

            <div class="tab-content">

                <!-- Notes Tab -->
                <div id="tab-notes" class="tab-pane active">
                    <div class="sidebar-title">
                        <h3><i class="fa fa-sticky-note"></i> Support Notes</h3>
                        <small>Add or review your personal support notes</small>
                    </div>

                    <div class="notes-list">
                        <!-- Example note -->
                        <div class="note-item">
                            <p>Follow up with client regarding ticket #1023</p>
                            <small>Added: 2 hours ago</small>
                            <button class="delete-note">Delete</button>
                        </div>
                    </div>

                    <div class="add-note">
                        <textarea id="new-note" placeholder="Write a new note..."></textarea>
                        <button id="add-note-btn">Add Note</button>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="tab-settings" class="tab-pane">
                    <div class="sidebar-title">
                        <h3><i class="fa fa-gears"></i> Support Settings</h3>
                    </div>

                    <div class="setings-item">
                        <span>Show notifications</span>
                        <div class="onoffswitch">
                            <input type="checkbox" class="onoffswitch-checkbox" id="notif">
                            <label class="onoffswitch-label" for="notif">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setings-item">
                        <span>Enable chat</span>
                        <div class="onoffswitch">
                            <input type="checkbox" class="onoffswitch-checkbox" id="chat" checked>
                            <label class="onoffswitch-label" for="chat">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setings-item">
                        <span>Show history</span>
                        <div class="onoffswitch">
                            <input type="checkbox" class="onoffswitch-checkbox" id="history">
                            <label class="onoffswitch-label" for="history">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setings-item">
                        <span>Offline status</span>
                        <div class="onoffswitch">
                            <input type="checkbox" class="onoffswitch-checkbox" id="offline" checked>
                            <label class="onoffswitch-label" for="offline">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                    </div>

                    <div class="sidebar-content">
                        <h4>Info</h4>
                        <div class="small">
                            Use these settings to manage notifications, chat, and user history for your Mindhaven support account.
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // Notes functionality
        const addBtn = document.getElementById('add-note-btn');
        const notesList = document.querySelector('.notes-list');

        addBtn.addEventListener('click', () => {
            const noteText = document.getElementById('new-note').value.trim();
            if (noteText) {
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.innerHTML = `<p>${noteText}</p><small>Added: just now</small><button class="delete-note">Delete</button>`;
                notesList.appendChild(noteItem);
                document.getElementById('new-note').value = '';
            }
        });

        notesList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-note')) {
                e.target.parentElement.remove();
            }
        });
    </script>


    <!-- 🌿 MindHaven Chatbot Widget (Compact Version) -->
    <div id="chatbotWidget">
        <!-- Floating Chat Button -->
        <button id="openChatBtn" class="btn shadow-lg"
                style="position: fixed; bottom: 90px; right: 25px;
                   background: #0b3d91; color: white; border: none;
                   border-radius: 50%; width: 58px; height: 58px;
                   font-size: 22px; z-index: 9999;">
            💬
        </button>

        <!-- Chat Window -->
        <div id="chatWindow" class="shadow-lg"
             style="display:none; position: fixed; bottom: 160px; right: 30px;
               width: 300px; height: 420px; border-radius: 14px;
               background: #0a2647; color: white; overflow: hidden; z-index: 10000;">

            <!-- Header -->
            <div style="background: linear-gradient(135deg, #144272, #0a2647);
                    color: #fff; text-align: center; padding: 10px 0;
                    font-weight: 600; font-size: 16px;">
                🌿 MindHaven
            </div>

            <!-- Chat Body -->
            <div id="chatBox"
                 style="height: 310px; overflow-y: auto; padding: 10px;
                    background: #144272; font-size: 13px;">
                <div style="text-align:center; color:#cfe0ff; margin-top:10px;">
                    👋 Hi there! I'm MindHaven — here to listen and help you feel calm.
                </div>
            </div>

            <!-- Footer -->
            <div style="display:flex; align-items:center; padding:8px;
                    border-top: 1px solid #1e3d6b; background:#0b3d91;">
                <input type="text" id="userInput" class="form-control me-2"
                       placeholder="Type..."
                       style="background:#1e3d6b; color:white;
                          border:none; border-radius:18px;
                          font-size:13px; padding:6px 10px;" />
                <button class="btn"
                        style="border-radius:50%; background:#6ba8ff; color:#0a2647;
                           border:none; width:36px; height:36px;"
                        onclick="sendMessage()">
                    ➤
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatBtn = document.getElementById('openChatBtn');
        const chatWindow = document.getElementById('chatWindow');
        const chatBox = document.getElementById('chatBox');
        const input = document.getElementById('userInput');

        // Toggle open/close
        chatBtn.addEventListener('click', () => {
            chatWindow.style.display = chatWindow.style.display === 'none' ? 'block' : 'none';
        });

        // Send user message
        async function sendMessage() {
            const userMessage = input.value.trim();
            if (!userMessage) return;

            appendMessage('user', userMessage);
            input.value = '';

            try {
                const response = await fetch('/Chat/Send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ message: userMessage })
                });

                const data = await response.json();
                if (data.success)
                    appendMessage('bot', data.reply);
                else
                    appendMessage('bot', "⚠️ Sorry, I couldn't parse the response.");
            } catch {
                appendMessage('bot', '⚠️ Connection issue. Try again later.');
            }
        }

        // Display messages
        function appendMessage(role, text) {
            const msgDiv = document.createElement('div');
            msgDiv.style.marginBottom = '8px';
            msgDiv.style.wordWrap = 'break-word';

            if (role === 'user') {
                msgDiv.style.textAlign = 'right';
                msgDiv.innerHTML = `<div style="display:inline-block; background:#6ba8ff;
                                                    color:#0a2647; padding:6px 10px;
                                                    border-radius:12px 12px 0 12px;
                                                    max-width:80%;">${text}</div>`;
            } else {
                msgDiv.style.textAlign = 'left';
                msgDiv.innerHTML = `<div style="display:inline-block; background:#1e3d6b;
                                                    color:#e4f1ff; padding:6px 10px;
                                                    border-radius:12px 12px 12px 0;
                                                    max-width:80%;">${text}</div>`;
            }

            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        input.addEventListener('keypress', e => { if (e.which === 13) sendMessage(); });
    </script>






    <!-- Mainly scripts -->

    <script src="~/Template/js/bootstrap.min.js"></script>
    <script src="~/Template/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="~/Template/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>


    <!-- Flot -->
    <script src="~/Template/js/plugins/flot/jquery.flot.js"></script>
    <script src="~/Template/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="~/Template/js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="~/Template/js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="~/Template/js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="~/Template/js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="~/Template/js/plugins/flot/curvedLines.js"></script>

    <!-- Peity -->
    <script src="~/Template/js/plugins/peity/jquery.peity.min.js"></script>
    <script src="~/Template/js/demo/peity-demo.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="~/Template/js/inspinia.js"></script>
    <script src="~/Template/js/plugins/pace/pace.min.js"></script>

    <!-- jQuery UI -->
    <script src="~/Template/js/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- Jvectormap -->
    <script src="~/Template/js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="~/Template/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

    <!-- Sparkline -->
    <script src="~/Template/js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!-- Sparkline demo data  -->
    <script src="~/Template/js/demo/sparkline-demo.js"></script>

    <!-- ChartJS-->
    <script src="~/Template/js/plugins/chartJs/Chart.min.js"></script>
    <script src="~/Template/js/plugins/dataTables/datatables.min.js"></script>








    @RenderSection("Scripts", required: false)
    @RenderSection("Styles", required: false)

</body>

</html>
